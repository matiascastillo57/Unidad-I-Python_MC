{% extends 'base.html' %}

{% block title %}Panel de Dispositivos - EcoEnergy{% endblock %}

{% block content %}
<div class="card">
    <h2>ğŸ“Š Panel de Dispositivos Conectados</h2>
    
    <div class="stats">
        <div class="stat">
            <h3>{{ total_dispositivos }}</h3>
            <p>Total Dispositivos</p>
        </div>
        <div class="stat">
            <h3>{{ dispositivos_criticos }}</h3>
            <p>En Estado CrÃ­tico</p>
        </div>
    </div>
    
    {% if dispositivos_criticos > 0 %}
    <div class="alert warning">
        âš ï¸ <strong>AtenciÃ³n:</strong> {{ dispositivos_criticos }} dispositivo{{ dispositivos_criticos|pluralize }} excede{{ dispositivos_criticos|pluralize:"n," }} el lÃ­mite de consumo.
    </div>
    {% else %}
    <div class="alert success">
        âœ… <strong>Sistema OK:</strong> Todos los dispositivos estÃ¡n dentro de los lÃ­mites permitidos.
    </div>
    {% endif %}
</div>

<div class="card">
    <h3>ğŸ“± Lista de Dispositivos</h3>
    
    {% for dispositivo in dispositivos %}
    <div class="device {% if dispositivo.esta_en_limite %}normal{% else %}critico{% endif %}">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <strong>{{ dispositivo.nombre }}</strong>
                <br>
                <small>
                    ğŸ“‚ {{ dispositivo.categoria.nombre }} | 
                    ğŸ“ {{ dispositivo.zona.nombre }} |
                    ğŸ”Œ {{ dispositivo.consumo_actual }}W / {{ dispositivo.consumo_max }}W
                </small>
            </div>
            <div style="text-align: right;">
                {% if dispositivo.esta_en_limite %}
                    <span style="color: #27ae60; font-weight: bold;">âœ… OK</span>
                {% else %}
                    <span style="color: #e74c3c; font-weight: bold;">âš ï¸ CRÃTICO</span>
                {% endif %}
                <br>
                <small>{{ dispositivo.porcentaje_consumo }}%</small>
                <br>
                <a href="{% url 'dispositivos:detalle' dispositivo.id %}" class="btn" style="font-size: 0.8em; padding: 0.3rem 0.6rem;">Ver Detalle</a>
            </div>
        </div>
    </div>
    {% empty %}
    <p>No hay dispositivos registrados en el sistema.</p>
    {% endfor %}
</div>

<div class="card">
    <h3>ğŸ”— Acciones RÃ¡pidas</h3>
    <a href="{% url 'dispositivos:mediciones' %}" class="btn">ğŸ“ˆ Ver Mediciones</a>
    <a href="/admin/dispositivos/dispositivo/add/" class="btn">â• Agregar Dispositivo</a>
</div>
{% endblock %}